## Maddy Mail Server - Minimal Working Configuration
## Compatible with Maddy 0.8.x

$(hostname) = {env:MADDY_HOSTNAME}
$(primary_domain) = {env:MADDY_DOMAIN}

# TLS Configuration
tls file /etc/maddy/tls_cert.pem /etc/maddy/tls_key.pem

# State directory
state_dir /var/lib/maddy

# --- Authentication Database (SQLite) ---
auth.pass_table local_authdb {
    table sql_table {
        driver sqlite3
        dsn credentials.db
        table_name passwords
    }
}

# --- Local Mailboxes (SQLite) ---
storage.imapsql local_mailboxes {
    driver sqlite3
    dsn mail.db
}

# --- SMTP (Port 25) - Receive incoming mail ---
smtp tcp://0.0.0.0:25 {
    hostname $(hostname)

    deliver_to &local_mailboxes
}

# --- Submission (Port 587) - Authenticated sending ---
submission tcp://0.0.0.0:587 {
    hostname $(hostname)

    auth &local_authdb

    deliver_to &local_mailboxes
}

# --- IMAP (Port 993) - Mail retrieval ---
imap tls://0.0.0.0:993 {
    auth &local_authdb
    storage &local_mailboxes
}
