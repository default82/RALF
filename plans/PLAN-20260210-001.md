# Plan

## ID
PLAN-20260210-001

## Referenz-Intent
INTENT-20260210-001

## Scope
Enthalten:
- LXC-Container erstellen (CT-ID 2010, Ubuntu 24.04)
- PostgreSQL 16 installieren und konfigurieren
- Netzwerkzugriff aus Homelab (scram-sha-256)
- Snapshot pre-install

Nicht enthalten:
- DB-User/Datenbanken fuer einzelne Services (separate Changes)
- Backup-Automatisierung (folgt spaeter)
- Monitoring-Integration (folgt spaeter)

## Schritte
1. Network Health Check ausfuehren -> muss gruen sein
2. OpenTofu init + plan (iac/stacks/postgresql-fz/)
3. OpenTofu apply -> LXC-Container wird erstellt
4. Ansible-Playbook deploy-postgresql.yml ausfuehren
5. Smoke-Test (tests/postgresql/smoke.sh) ausfuehren
6. Change-Artefakt erstellen

## Tests / Verifikation
- Erreichbarkeit: `ping 10.10.20.10` + TCP/5432 offen
- Funktionstest: `pg_isready -h 10.10.20.10`
- Smoke-Test: `tests/postgresql/smoke.sh` gruen

## Rollback
- Snapshot `pre-install` vor Installation
- Restore: `pct stop 2010 && pct rollback 2010 pre-install && pct start 2010`
- Alternativ: `tofu destroy` um Container komplett zu entfernen

## Risiken
- Proxmox API Token fehlt/falsch -> kein Deploy moeglich
- Ubuntu Template nicht vorhanden -> Download noetig
- Netzwerk nicht ready -> Gatekeeper blockt

## Freigabe
- [ ] Genehmigt
- [ ] Abgelehnt

Datum / Entscheidung:
